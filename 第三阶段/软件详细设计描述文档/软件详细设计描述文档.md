# 影院影片管理系统软件详细设计描述文档

## 文档修改历史

| 修改人员 | 日期 | 修改原因 | 版本号 |
|:--------:| ---- | -------- | ------ |
| 梁正川 | 2019/05/21 | 增加promotion模块 | V0.1 |

## 目录

	1. 引言
		1.1 编制目的
		1.2 词汇表
		1.3 参考资料
	
	2. 产品概述
	3. 系统结构设计概述
	4. 结构视角
		4.1 业务逻辑层的分解
			4.1.1 management模块
			4.1.2 promotion模块
			4.1.3 sales模块
			4.1.4 statistics模块
			4.1.5 user模块
	
	5. 依赖视角

## 1. 引言

### 1.1 编制目的

本报告详细完成对影院影片管理系统的详细设计，达到指导后续软件构造的目的，同时实现和测试人员及用户的沟通。

本报告面向开发人员、测试人员及最终用户而编写，是了解系统的导航。

### 1.2 词汇表

| 词汇名称 | 词汇含义 | 备注 |
|:--------:|:--------:|:----:|
| promotion | 一切刺激观众消费的方式 | 如优惠券、会员卡 |

### 1.3 参考资料

软件开发的技术基础 软件工程与计算（卷二） —— 罗斌、丁二玉、刘钦

## 2. 产品描述

参考影院影片管理系统用例文档和影院影片管理系统软件需求规格说明文档中对产品的概括描述。

## 3. 系统结构设计概述

参考影院影片管理系统概要设计文档中对系统体系结构设计的概述。

## 4. 结构视角

### 4.1 业务逻辑层的分解

业务逻辑层的开发包图参见软件体系结构文档图。

#### 4.1.1 management模块

(1) 模块概述

(2) 整体结构

(3) 模块内部类的接口规范

需要的服务（需接口）

| 服务名                                | 服务                           |
| ------------------------------------- | ------------------------------ |
| HallMapper.selectAllHall()            | 查找返回所有的持久化对象       |
| HallMapper.selectHallById(int hallId) | 根据id返回特定单一的持久化对象 |
| HallMapper.insertOneHall(Hall hall)   | 增加单一Hall持久化对象         |
| HallMapper.updateOneHall(Hall hall)   | 更新单一Hall持久化对象         |

(4) 业务逻辑层的动态模型

(5) 业务逻辑层的设计原理

#### 4.1.2 promotion模块

(1) 模块概述

(2) 整体结构

(3) 模块内部类的接口规范

ActivityServiceImpl的接口规范如下表所示。

<table>
<tr><td colspan="3"><center>提供的服务（供接口）</center></td></tr>

<tr><td rowspan="4">ActivityServiceImpl.participate</td></tr>
<tr><td>语法</td><td>public void participate(int movieId, int userId)</td></tr>
<tr><td>前置条件</td><td>无</td></tr>
<tr><td>后置条件</td><td>如果观看该电影为单个或多个优惠活动的参与条件，用户获得这些优惠活动的优惠券</td></tr>

<tr><td colspan="3"><center>需要的服务（需接口）</center></td></tr>

<tr><td>服务名</td><td colspan="2">服务</td></tr>
<tr><td>ActivityMapper.selectActivitiesByMovie(int movieId)</td><td colspan="2">选择优惠电影列表中含有某电影的优惠活动</td></tr>
<tr><td>ActivityMapper.selectActivitiesWithoutMovie()</td><td colspan="2">选择条件为“观看任意电影”的优惠活动</td></tr>
<tr><td>CouponServiceForBl.issueCoupon(List<Integer> couponIdList, List<Integer> userIdList)</td><td colspan="2">让多个观众每人都获得多个优惠劵</td></tr>

</table>

CouponServiceImpl的接口规范如下表所示。

<table>
<tr><td colspan="3"><center>提供的服务（供接口）</center></td></tr>

<tr><td rowspan="4">CouponServiceImpl.getValidCoupons</td></tr>
<tr><td>语法</td><td>public ResponseVO getValidCoupons()</td></tr>
<tr><td>前置条件</td><td>无</td></tr>
<tr><td>后置条件</td><td>返回当前处于有效期的优惠劵</td></tr>

<tr><td rowspan="4">CouponServiceImpl.issueCoupon</td></tr>
<tr><td>语法</td><td>public ResponseVO issueCoupon(List<Integer> couponIdList, List<Integer> userIdList)</td></tr>
<tr><td>前置条件</td><td>优惠券列表和用户列表中的id有效</td></tr>
<tr><td>后置条件</td><td>返回赠送是否成功</td></tr>

<tr><td colspan="3"><center>需要的服务（需接口）</center></td></tr>

<tr><td>服务名</td><td colspan="2">服务</td></tr>
<tr><td>CouponMapper.selectValidCoupons()</td><td colspan="2">获得当前处于有效期的优惠劵</td></tr>
<tr><td>CouponMapper.insertCouponUser(couponId, userId)</td><td colspan="2">让某观众获得某优惠劵</td></tr>

</table>

VIPServiceImpl的接口规范如下表所示。

<table>
<tr><td colspan="3"><center>提供的服务（供接口）</center></td></tr>

<tr><td rowspan="4">VIPServiceImpl.addStrategy</td></tr>
<tr><td>语法</td><td>public ResponseVO addStrategy(VIPCardStrategyForm strategyForm)</td></tr>
<tr><td>前置条件</td><td>无</td></tr>
<tr><td>后置条件</td><td>返回发布会员卡充值优惠策略是否成功</td></tr>

<tr><td rowspan="4">VIPServiceImpl.updateStrategy</td></tr>
<tr><td>语法</td><td>public ResponseVO updateStrategy(VIPCardStrategyForm strategyForm)</td></tr>
<tr><td>前置条件</td><td>strategyForm中的id属性有效</td></tr>
<tr><td>后置条件</td><td>返回发布会员卡充值优惠策略修改是否成功</td></tr>

<tr><td rowspan="4">VIPServiceImpl.removeStrategy</td></tr>
<tr><td>语法</td><td>public ResponseVO removeStrategy(int strategyId)</td></tr>
<tr><td>前置条件</td><td>strategyId有效</td></tr>
<tr><td>后置条件</td><td>返回发布会员卡充值优惠策略删除是否成功</td></tr>

<tr><td rowspan="4">VIPServiceImpl.getAllStrategies</td></tr>
<tr><td>语法</td><td>public ResponseVO getAllStrategies()</td></tr>
<tr><td>前置条件</td><td>无</td></tr>
<tr><td>后置条件</td><td>返回所有会员卡充值优惠策略</td></tr>

<tr><td rowspan="4">VIPServiceImpl.addVIPCard</td></tr>
<tr><td>语法</td><td>ResponseVO addVIPCard(int userId, int strategyId)</td></tr>
<tr><td>前置条件</td><td>userId和strategyId有效</td></tr>
<tr><td>后置条件</td><td>如果用户已有会员卡，切换会员卡；否则，新增会员卡</td></tr>

<tr><td rowspan="4">VIPServiceImpl.pay</td></tr>
<tr><td>语法</td><td>public boolean pay(int userId, double pay)</td></tr>
<tr><td>前置条件</td><td>userId有效，pay >= 0</td></tr>
<tr><td>后置条件</td><td>返回会员卡支付是否成功</td></tr>

<tr><td rowspan="4">VIPServiceImpl.getCardByUserId</td></tr>
<tr><td>语法</td><td>public ResponseVO getCardByUserId(int userId)</td></tr>
<tr><td>前置条件</td><td>userId有效</td></tr>
<tr><td>后置条件</td><td>返回用户持有的会员卡</td></tr>

<tr><td rowspan="4">VIPServiceImpl.getChargeRecords</td></tr>
<tr><td>语法</td><td>public ResponseVO getChargeRecords(int vipCardId)</td></tr>
<tr><td>前置条件</td><td>vipCardId有效</td></tr>
<tr><td>后置条件</td><td>返回用户持有的会员卡的充值记录</td></tr>

<tr><td colspan="3"><center>需要的服务（需接口）</center></td></tr>

<tr><td>服务名</td><td colspan="2">服务</td></tr>
<tr><td>VIPCardMapper.insertStrategy(VIPCardStrategy vipCardStrategy)</td><td colspan="2">插入单一会员卡充值优惠策略</td></tr>
<tr><td>VIPCardMapper.updateStrategy(VIPCardStrategy vipCardStrategy)</td><td colspan="2">更新单一会员卡充值优惠策略</td></tr>
<tr><td>VIPCardMapper.deleteStrategy(int id)</td><td colspan="2">删除单一会员卡充值优惠策略</td></tr>
<tr><td>VIPCardMapper.selectStrategies()</td><td colspan="2">查找所有会员卡充值优惠策略</td></tr>
<tr><td>VIPCardMapper.selectCardByUserId(int userId)</td><td colspan="2">根据userId查找单一会员卡</td></tr>
<tr><td>VIPCardMapper.insertOneCard(VIPCard vipCard)</td><td colspan="2">插入单一会员卡</td></tr>
<tr><td>VIPCardMapper.updateCardStrategy(int id, int strategyId)</td><td colspan="2">更新单一会员卡充值优惠策略</td></tr>
<tr><td>VIPCardMapper.updateCardBalance(int id, double balance)</td><td colspan="2">更新单一会员卡余额</td></tr>
<tr><td>VIPCardMapper.selectChargeRecordsByCard(int vipCardId)</td><td colspan="2">根据vipCardId查找单一会员卡的多个充值记录</td></tr>

</table>

(4) 业务逻辑层的动态模型

(5) 业务逻辑层的设计原理

#### 4.1.3 sales模块

(1) 模块概述

(2) 整体结构

(3) 模块内部类的接口规范

TicketServiceImpl的接口规范如下表所示。

<table>
<tr><td colspan="3"><center>提供的服务（供接口）</center></td></tr>
<tr><td rowspan="4">TicketServiceImpl.refund</td></tr>
<tr><td>语法</td><td>public ResponseVO refund(int ticketId)</td></tr>
<tr><td>前置条件</td><td>订单已支付并未出票</td></tr>
<tr><td>后置条件</td><td>依据退票策略来退票</td></tr>

<tr><td rowspan="4">TicketServiceImpl.addRefundStrategy</td></tr>
<tr><td>语法</td><td>public ResponseVO addRefundStrategy(RefundTicketStrategyForm refundTicketStrategyForm)</td></tr>
<tr><td>前置条件</td><td>无</td></tr>
<tr><td>后置条件</td><td>新增退票策略</td></tr>

<tr><td rowspan="4">TicketServiceImpl.updateRefundTicketStrategy</td></tr>
<tr><td>语法</td><td>public ResponseVO updateRefundTicketStrategy(RefundTicketStrategyForm updateRefundTicketStrategyForm)</td></tr>
<tr><td>前置条件</td><td>无</td></tr>
<tr><td>后置条件</td><td>修改退票策略</td></tr>

<tr><td colspan="3"><center>需要的服务（需接口）</center></td></tr>

<tr><td rowspan="4">TicketMapper.selectTicketById</td></tr>
<tr><td>语法</td><td>public Ticket selectTicketById(int ticketId)</td></tr>
<tr><td>前置条件</td><td>无</td></tr>
<tr><td>后置条件</td><td>返回指定id的电影票</td></tr>

<tr><td rowspan="4">RefundTicketStrategyMapper.getRefundStrategyById</td></tr>
<tr><td>语法</td><td>public Ticket getTimeLimit()</td></tr>
<tr><td>前置条件</td><td>无</td></tr>
<tr><td>后置条件</td><td>返回可退电影票的时限</td></tr>

<tr><td rowspan="4">RefundTicketStrategyMapper.getProportion</td></tr>
<tr><td>语法</td><td>public double getProportion()</td></tr>
<tr><td>前置条件</td><td>无</td></tr>
<tr><td>后置条件</td><td>返回退票金额的比例</td></tr>
</table>

需要的服务（需接口）

|服务名|服务|
|--|--|
|TicketMapper.updateTicketState(int ticketId, int state)||
|TicketMapper.insertOneRefundStrategy(TicketRefundStrategy strategy)||
|TicketMapper.updateOneRefundStrategy(TicketRefundStrategy strategy)||
|TicketMapper.insertStrategyAndMovies(int strategyId, List<Integer> movieIdList)||
|TicketMapper.deleteStrategyAndMovies(int strategyId, List<Integer> movieIdList)||
|TicketMapper.selectRefundStrategyById(int id)||
|TicketMapper.selectRefundStrategyByMovie(int movieId)||
|TicketMapper.selectTicketById(int id)||
|TicketMapper.selectRefundStrategies()||
|ScheduleServiceForBl.getScheduleItemById(int id)||

(4) 业务逻辑层的动态模型

(5) 业务逻辑层的设计原理

#### 4.1.4 statistics模块

(1) 模块概述

(2) 整体结构

(3) 模块内部类的接口规范

提供的接口

| StatisticsServiceImpl.getRechargeRecord       | 语法 | public ResponsegetRechargeRecord(int userId)         |
| --------------------------------------------- | ---- | ---------------------------------------------------- |
| StatisticServiceImpl.getHistoricalConsumption | 语法 | public Response getHistoricalConsumption(int userId) |
| StatisticServiceImpl.getTotalConsumption      | 语法 | public Response getTotalConsumption(int useId)       |

需要的接口

| 服务名                                               | 服务                         |
| ---------------------------------------------------- | ---------------------------- |
| VIPServiceForBl.getChargeRecords(int userId)         | 根据userId查找多个持久化对象 |
| TicketServiceForBl.getTicketsByUserForBl(int userId) | 根据userId查找多个持久化对象 |
| StatisticsMapper.selectConsumption(double amount)    | 查找多个持久化对象           |

(4) 业务逻辑层的动态模型

(5) 业务逻辑层的设计原理

#### 4.1.5 user模块

(1) 模块概述

(2) 整体结构

(3) 模块内部类的接口规范

需要的服务（需接口）

| 服务名                                         | 服务                                              |
| ---------------------------------------------- | ------------------------------------------------- |
| AccountMapper.selectAdmins()                   | 查找返回所有身份是Commander（管理员）的持久化对象 |
| AccountMapper.getAccountByName(String username)| 根据用户名返回特定单一的持久化对象                |
| AccountMapper.insertOneAccount(User user)      | 增加单一User持久化对象                            |
| AccountMapper.updateOneAccount(User user)      | 更新单一User持久化对象                            |
| AccountMapper.deleteOneAccount(int id)         | 删除单一User持久化对象                            |

提供的服务（）

(4) 业务逻辑层的动态模型

(5) 业务逻辑层的设计原理

## 5. 依赖视角

下图是包之间的依赖关系。

![](https://raw.githubusercontent.com/president-for-life/NJU-SF2/master/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%8F%8F%E8%BF%B0%E6%96%87%E6%A1%A3/%E5%9B%BE%E7%89%87/%E5%8C%85%E5%9B%BE.jpg)
