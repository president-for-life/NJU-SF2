# å½±é™¢å½±ç‰‡ç®¡ç†ç³»ç»Ÿè½¯ä»¶è¯¦ç»†è®¾è®¡æè¿°æ–‡æ¡£

## æ–‡æ¡£ä¿®æ”¹å†å²

| ä¿®æ”¹äººå‘˜ | æ—¥æœŸ | ä¿®æ”¹åŸå›  | ç‰ˆæœ¬å· |
|:--------:| ---- | -------- | ------ |
| æ¢æ­£å· | 2019/05/21 | å¢åŠ promotionæ¨¡å— | V0.1 |
| çŸ³å‰µçƒ½ | 2019/05/21 | å¢åŠ salesæ¨¡å—å’Œpromotionæ¨¡å—å’Œstatisticæ¨¡å— | V0.2 |

## ç›®å½•

	1. å¼•è¨€
		1.1 ç¼–åˆ¶ç›®çš„
		1.2 è¯æ±‡è¡¨
		1.3 å‚è€ƒèµ„æ–™

	2. äº§å“æ¦‚è¿°
	3. ç³»ç»Ÿç»“æ„è®¾è®¡æ¦‚è¿°
	4. ç»“æ„è§†è§’
		4.1 ä¸šåŠ¡é€»è¾‘å±‚çš„åˆ†è§£
			4.1.1 managementæ¨¡å—
			4.1.2 promotionæ¨¡å—
			4.1.3 salesæ¨¡å—
			4.1.4 statisticsæ¨¡å—
			4.1.5 useræ¨¡å—

	5. ä¾èµ–è§†è§’

## 1. å¼•è¨€

### 1.1 ç¼–åˆ¶ç›®çš„

æœ¬æŠ¥å‘Šè¯¦ç»†å®Œæˆå¯¹å½±é™¢å½±ç‰‡ç®¡ç†ç³»ç»Ÿçš„è¯¦ç»†è®¾è®¡ï¼Œè¾¾åˆ°æŒ‡å¯¼åç»­è½¯ä»¶æ„é€ çš„ç›®çš„ï¼ŒåŒæ—¶å®ç°å’Œæµ‹è¯•äººå‘˜åŠç”¨æˆ·çš„æ²Ÿé€šã€‚

æœ¬æŠ¥å‘Šé¢å‘å¼€å‘äººå‘˜ã€æµ‹è¯•äººå‘˜åŠæœ€ç»ˆç”¨æˆ·è€Œç¼–å†™ï¼Œæ˜¯äº†è§£ç³»ç»Ÿçš„å¯¼èˆªã€‚

### 1.2 è¯æ±‡è¡¨

| è¯æ±‡åç§° | è¯æ±‡å«ä¹‰ | å¤‡æ³¨ |
|:--------:|:--------:|:----:|
| promotion | ä¸€åˆ‡åˆºæ¿€è§‚ä¼—æ¶ˆè´¹çš„æ–¹å¼ | å¦‚ä¼˜æƒ åˆ¸ã€ä¼šå‘˜å¡ |

### 1.3 å‚è€ƒèµ„æ–™

è½¯ä»¶å¼€å‘çš„æŠ€æœ¯åŸºç¡€ è½¯ä»¶å·¥ç¨‹ä¸è®¡ç®—ï¼ˆå·äºŒï¼‰ â€”â€” ç½—æ–Œã€ä¸äºŒç‰ã€åˆ˜é’¦

## 2. äº§å“æè¿°

å‚è€ƒå½±é™¢å½±ç‰‡ç®¡ç†ç³»ç»Ÿç”¨ä¾‹æ–‡æ¡£å’Œå½±é™¢å½±ç‰‡ç®¡ç†ç³»ç»Ÿè½¯ä»¶éœ€æ±‚è§„æ ¼è¯´æ˜æ–‡æ¡£ä¸­å¯¹äº§å“çš„æ¦‚æ‹¬æè¿°ã€‚

## 3. ç³»ç»Ÿç»“æ„è®¾è®¡æ¦‚è¿°

å‚è€ƒå½±é™¢å½±ç‰‡ç®¡ç†ç³»ç»Ÿæ¦‚è¦è®¾è®¡æ–‡æ¡£ä¸­å¯¹ç³»ç»Ÿä½“ç³»ç»“æ„è®¾è®¡çš„æ¦‚è¿°ã€‚

## 4. ç»“æ„è§†è§’

### 4.1 ä¸šåŠ¡é€»è¾‘å±‚çš„åˆ†è§£

ä¸šåŠ¡é€»è¾‘å±‚çš„å¼€å‘åŒ…å›¾å‚è§è½¯ä»¶ä½“ç³»ç»“æ„æ–‡æ¡£å›¾ã€‚

#### 4.1.1 managementæ¨¡å—

(1) æ¨¡å—æ¦‚è¿°

(2) æ•´ä½“ç»“æ„

(3) æ¨¡å—å†…éƒ¨ç±»çš„æ¥å£è§„èŒƒ

éœ€è¦çš„æœåŠ¡ï¼ˆéœ€æ¥å£ï¼‰

| æœåŠ¡å                                | æœåŠ¡                           |
| ------------------------------------- | ------------------------------ |
| HallMapper.selectAllHall()            | æŸ¥æ‰¾è¿”å›æ‰€æœ‰çš„æŒä¹…åŒ–å¯¹è±¡       |
| HallMapper.selectHallById(int hallId) | æ ¹æ®idè¿”å›ç‰¹å®šå•ä¸€çš„æŒä¹…åŒ–å¯¹è±¡ |
| HallMapper.insertOneHall(Hall hall)   | å¢åŠ å•ä¸€HallæŒä¹…åŒ–å¯¹è±¡         |
| HallMapper.updateOneHall(Hall hall)   | æ›´æ–°å•ä¸€HallæŒä¹…åŒ–å¯¹è±¡         |

(4) ä¸šåŠ¡é€»è¾‘å±‚çš„åŠ¨æ€æ¨¡å‹

(5) ä¸šåŠ¡é€»è¾‘å±‚çš„è®¾è®¡åŸç†

#### 4.1.2 promotionæ¨¡å—

(1) æ¨¡å—æ¦‚è¿°

promotionæ¨¡å—æ‰¿æ‹…çš„éœ€æ±‚å‚è§éœ€æ±‚è§„æ ¼è¯´æ˜æ–‡æ¡£åŠŸèƒ½éœ€æ±‚åŠç›¸å…³éåŠŸèƒ½éœ€æ±‚ã€‚
promotionæ¨¡å—çš„èŒè´£åŠæ¥å£å‚è§è½¯ä»¶ç³»ç»Ÿç»“æ„æè¿°æ–‡æ¡£è¡¨ã€‚

(2) æ•´ä½“ç»“æ„

æ ¹æ®ä½“ç³»ç»“æ„çš„è®¾è®¡ï¼Œæˆ‘ä»¬å°†ç³»ç»Ÿåˆ†ä¸ºå±•ç¤ºå±‚ã€ä¸šåŠ¡é€»è¾‘å±‚ã€æ•°æ®å±‚ã€‚æ¯ä¸€å±‚ä¹‹é—´ä¸ºäº†å¢åŠ çµæ´»æ€§ï¼Œæˆ‘ä»¬ä¼šæ·»åŠ æ¥å£ã€‚æ¯”å¦‚å±•ç¤ºå±‚å’Œä¸šåŠ¡é€»è¾‘å±‚ä¹‹é—´ï¼Œæˆ‘ä»¬æ·»åŠ bl.promotion.ActivityServiceã€bl.promotion.CouponServiceå’Œbl.promotion.VIPServiceæ¥å£ã€‚ä¸šåŠ¡é€»è¾‘å±‚å’Œæ•°æ®å±‚ä¹‹é—´æ·»åŠ data.promotion.ActivityMapperã€data.promotion.CouponMapperå’Œdata.promotion.VIPCardMapperæ¥å£ã€‚Activityã€Couponå’ŒVIPCardæ˜¯ä½œä¸ºæŒä¹…åŒ–å¯¹è±¡è¢«æ·»åŠ åˆ°è®¾è®¡æ¨¡å‹ä¸­å»çš„ã€‚

![]()
å›¾ promotionæ¨¡å—å„ä¸ªç±»çš„è®¾è®¡

è¡¨ promotionæ¨¡å—å„ä¸ªç±»çš„èŒè´£

| ç±»                  | èŒè´£                                                             |
| ------------------- | ---------------------------------------------------------------- |
| ActivityServiceImpl | è´Ÿè´£å®ç°å‘å¸ƒã€å‚ä¸ä¼˜æƒ æ´»åŠ¨æ‰€éœ€è¦çš„æœåŠ¡                           |
| CouponServiceImpl   | è´Ÿè´£å®ç°ç”¨æˆ·è·å¾—ä¼˜æƒ åŠµæ‰€éœ€è¦çš„æœåŠ¡                               |
| VIPServiceImpl      | è´Ÿè´£å®ç°ä¼šå‘˜å¡å‘å¸ƒã€ä¿®æ”¹ã€åˆ é™¤ã€åˆ‡æ¢ã€æ”¯ä»˜ã€æŸ¥çœ‹å……å€¼æ‰€éœ€è¦çš„æœåŠ¡ |

(3) æ¨¡å—å†…éƒ¨ç±»çš„æ¥å£è§„èŒƒ

ActivityServiceImplçš„æ¥å£è§„èŒƒå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚

<table>
<tr><td colspan="3"><center>æä¾›çš„æœåŠ¡ï¼ˆä¾›æ¥å£ï¼‰</center></td></tr><tr><td rowspan="4">ActivityServiceImpl.participate</td></tr>
<tr><td>è¯­æ³•</td><td>public void participate(int movieId, int userId)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>æ— </td></tr>
    <tr><td>åç½®æ¡ä»¶</td><td>å¦‚æœè§‚çœ‹è¯¥ç”µå½±ä¸ºå•ä¸ªæˆ–å¤šä¸ªä¼˜æƒ æ´»åŠ¨çš„å‚ä¸æ¡ä»¶ï¼Œç”¨æˆ·è·å¾—è¿™äº›ä¼˜æƒ æ´»åŠ¨çš„ä¼˜æƒ åˆ¸</td></tr></table>

<table><tr><td colspan="3"><center>éœ€è¦çš„æœåŠ¡ï¼ˆéœ€æ¥å£ï¼‰</center></td></tr><tr><td>æœåŠ¡å</td><td colspan="2">æœåŠ¡</td></tr>
<tr><td>ActivityMapper.selectActivitiesByMovie(int movieId)</td><td colspan="2">é€‰æ‹©ä¼˜æƒ ç”µå½±åˆ—è¡¨ä¸­å«æœ‰æŸç”µå½±çš„ä¼˜æƒ æ´»åŠ¨</td></tr>
<tr><td>ActivityMapper.selectActivitiesWithoutMovie()</td><td colspan="2">é€‰æ‹©æ¡ä»¶ä¸ºâ€œè§‚çœ‹ä»»æ„ç”µå½±â€çš„ä¼˜æƒ æ´»åŠ¨</td></tr>
<tr><td>CouponServiceForBl.issueCoupon(List<Integer> couponIdList, List<Integer> userIdList)</td><td colspan="2">è®©å¤šä¸ªè§‚ä¼—æ¯äººéƒ½è·å¾—å¤šä¸ªä¼˜æƒ åŠµ</td></tr></table>

CouponServiceImplçš„æ¥å£è§„èŒƒå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚

<table>
<tr><td colspan="3"><center>æä¾›çš„æœåŠ¡ï¼ˆä¾›æ¥å£ï¼‰</center></td></tr><tr><td rowspan="4">CouponServiceImpl.getValidCoupons</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO getValidCoupons()</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>æ— </td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è¿”å›å½“å‰å¤„äºæœ‰æ•ˆæœŸçš„ä¼˜æƒ åŠµ</td></tr><tr><td rowspan="4">CouponServiceImpl.issueCoupon</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO issueCoupon(List<Integer> couponIdList, List<Integer> userIdList)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>ä¼˜æƒ åˆ¸åˆ—è¡¨å’Œç”¨æˆ·åˆ—è¡¨ä¸­çš„idæœ‰æ•ˆ</td></tr>
    <tr><td>åç½®æ¡ä»¶</td><td>è¿”å›èµ é€æ˜¯å¦æˆåŠŸ</td></tr>
  <tr><td rowspan="4">VIPServiceImpl.getChargeRecrds</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO getChargeRecrds(int vipCardId)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>æ— </td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è¿”å›ä¼šå‘˜å¡å……å€¼è®°å½•</td></tr></table>

<table><tr><td colspan="3"><center>éœ€è¦çš„æœåŠ¡ï¼ˆéœ€æ¥å£ï¼‰</center></td></tr><tr><td>æœåŠ¡å</td><td colspan="2">æœåŠ¡</td></tr>
<tr><td>CouponMapper.selectValidCoupons()</td><td colspan="2">è·å¾—å½“å‰å¤„äºæœ‰æ•ˆæœŸçš„ä¼˜æƒ åŠµ</td></tr>
<tr><td>CouponMapper.insertCouponUser(couponId, userId)</td><td colspan="2">è®©æŸè§‚ä¼—è·å¾—æŸä¼˜æƒ åŠµ</td></tr>
<tr><td>CouponMapper.selectChargeRecordsByCard
(couponId)</td><td colspan="2">æ ¹æ®ä¼šå‘˜å¡idè·å–å¤šä¸ªVIPCardChargeæŒä¹…åŒ–å¯¹è±¡</td></tr></tablæ ¹æ®ä¼šå‘˜å¡idè·å–å¤šä¸ªVIPCardChargeæŒä¹…åŒ–å¯¹è±¡e>

VIPServiceImplçš„æ¥å£è§„èŒƒå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚

<table>
<tr><td colspan="3"><center>æä¾›çš„æœåŠ¡ï¼ˆä¾›æ¥å£ï¼‰</center></td></tr><tr><td rowspan="4">VIPServiceImpl.addStrategy</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO addStrategy(VIPCardStrategyForm strategyForm)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>æ— </td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è¿”å›å‘å¸ƒä¼šå‘˜å¡å……å€¼ä¼˜æƒ ç­–ç•¥æ˜¯å¦æˆåŠŸ</td></tr><tr><td rowspan="4">VIPServiceImpl.updateStrategy</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO updateStrategy(VIPCardStrategyForm strategyForm)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>strategyFormä¸­çš„idå±æ€§æœ‰æ•ˆ</td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è¿”å›å‘å¸ƒä¼šå‘˜å¡å……å€¼ä¼˜æƒ ç­–ç•¥ä¿®æ”¹æ˜¯å¦æˆåŠŸ</td></tr><tr><td rowspan="4">VIPServiceImpl.removeStrategy</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO removeStrategy(int strategyId)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>strategyIdæœ‰æ•ˆ</td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è¿”å›å‘å¸ƒä¼šå‘˜å¡å……å€¼ä¼˜æƒ ç­–ç•¥åˆ é™¤æ˜¯å¦æˆåŠŸ</td></tr><tr><td rowspan="4">VIPServiceImpl.getAllStrategies</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO getAllStrategies()</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>æ— </td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è¿”å›æ‰€æœ‰ä¼šå‘˜å¡å……å€¼ä¼˜æƒ ç­–ç•¥</td></tr><tr><td rowspan="4">VIPServiceImpl.addVIPCard</td></tr>
<tr><td>è¯­æ³•</td><td>ResponseVO addVIPCard(int userId, int strategyId)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>userIdå’ŒstrategyIdæœ‰æ•ˆ</td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>å¦‚æœç”¨æˆ·å·²æœ‰ä¼šå‘˜å¡ï¼Œåˆ‡æ¢ä¼šå‘˜å¡ï¼›å¦åˆ™ï¼Œæ–°å¢ä¼šå‘˜å¡</td></tr><tr><td rowspan="4">VIPServiceImpl.pay</td></tr>
<tr><td>è¯­æ³•</td><td>public boolean pay(int userId, double pay)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>userIdæœ‰æ•ˆï¼Œpay >= 0</td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è¿”å›ä¼šå‘˜å¡æ”¯ä»˜æ˜¯å¦æˆåŠŸ</td></tr><tr><td rowspan="4">VIPServiceImpl.getCardByUserId</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO getCardByUserId(int userId)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>userIdæœ‰æ•ˆ</td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è¿”å›ç”¨æˆ·æŒæœ‰çš„ä¼šå‘˜å¡</td></tr><tr><td rowspan="4">VIPServiceImpl.getChargeRecords</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO getChargeRecords(int vipCardId)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>vipCardIdæœ‰æ•ˆ</td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è¿”å›ç”¨æˆ·æŒæœ‰çš„ä¼šå‘˜å¡çš„å……å€¼è®°å½•</td></tr>
</table>

â€‹

<table><tr><td colspan="3"><center>éœ€è¦çš„æœåŠ¡ï¼ˆéœ€æ¥å£ï¼‰</center></td></tr><tr><td>æœåŠ¡å</td><td colspan="2">æœåŠ¡</td></tr>
<tr><td>VIPCardMapper.insertStrategy(VIPCardStrategy vipCardStrategy)</td><td colspan="2">æ’å…¥å•ä¸€ä¼šå‘˜å¡å……å€¼ä¼˜æƒ ç­–ç•¥</td></tr>
<tr><td>VIPCardMapper.updateStrategy(VIPCardStrategy vipCardStrategy)</td><td colspan="2">æ›´æ–°å•ä¸€ä¼šå‘˜å¡å……å€¼ä¼˜æƒ ç­–ç•¥</td></tr>
<tr><td>VIPCardMapper.deleteStrategy(int id)</td><td colspan="2">åˆ é™¤å•ä¸€ä¼šå‘˜å¡å……å€¼ä¼˜æƒ ç­–ç•¥</td></tr>
<tr><td>VIPCardMapper.selectStrategies()</td><td colspan="2">æŸ¥æ‰¾æ‰€æœ‰ä¼šå‘˜å¡å……å€¼ä¼˜æƒ ç­–ç•¥</td></tr>
<tr><td>VIPCardMapper.selectCardByUserId(int userId)</td><td colspan="2">æ ¹æ®userIdæŸ¥æ‰¾å•ä¸€ä¼šå‘˜å¡</td></tr>
<tr><td>VIPCardMapper.insertOneCard(VIPCard vipCard)</td><td colspan="2">æ’å…¥å•ä¸€ä¼šå‘˜å¡</td></tr>
<tr><td>VIPCardMapper.updateCardStrategy(int id, int strategyId)</td><td colspan="2">æ›´æ–°å•ä¸€ä¼šå‘˜å¡å……å€¼ä¼˜æƒ ç­–ç•¥</td></tr>
<tr><td>VIPCardMapper.updateCardBalance(int id, double balance)</td><td colspan="2">æ›´æ–°å•ä¸€ä¼šå‘˜å¡ä½™é¢</td></tr>
<tr><td>VIPCardMapper.selectChargeRecordsByCard(int vipCardId)</td><td colspan="2">æ ¹æ®vipCardIdæŸ¥æ‰¾å•ä¸€ä¼šå‘˜å¡çš„å¤šä¸ªå……å€¼è®°å½•</td></tr></table>

(4) ä¸šåŠ¡é€»è¾‘å±‚çš„åŠ¨æ€æ¨¡å‹

(5) ä¸šåŠ¡é€»è¾‘å±‚çš„è®¾è®¡åŸç†

åˆ©ç”¨å§”æ‰˜å¼æ§åˆ¶é£æ ¼ï¼Œæ¯ä¸ªç•Œé¢éœ€è¦è®¿é—®çš„ä¸šåŠ¡é€»è¾‘ç”±å„è‡ªçš„æ§åˆ¶å™¨å§”æ‰˜ç»™ä¸åŒçš„é¢†åŸŸå¯¹è±¡ã€‚

#### 4.1.3 salesæ¨¡å—

(1) æ¨¡å—æ¦‚è¿°

salesæ¨¡å—æ‰¿æ‹…çš„éœ€æ±‚å‚è§éœ€æ±‚è§„æ ¼è¯´æ˜æ–‡æ¡£åŠŸèƒ½éœ€æ±‚åŠç›¸å…³éåŠŸèƒ½éœ€æ±‚ã€‚
salesæ¨¡å—çš„èŒè´£åŠæ¥å£å‚è§è½¯ä»¶ç³»ç»Ÿç»“æ„æè¿°æ–‡æ¡£è¡¨ã€‚

(2) æ•´ä½“ç»“æ„

æ ¹æ®ä½“ç³»ç»“æ„çš„è®¾è®¡ï¼Œæˆ‘ä»¬å°†ç³»ç»Ÿåˆ†ä¸ºå±•ç¤ºå±‚ã€ä¸šåŠ¡é€»è¾‘å±‚ã€æ•°æ®å±‚ã€‚æ¯ä¸€å±‚ä¹‹é—´ä¸ºäº†å¢åŠ çµæ´»æ€§ï¼Œæˆ‘ä»¬ä¼šæ·»åŠ æ¥å£ã€‚å±•ç¤ºå±‚å’Œä¸šåŠ¡é€»è¾‘å±‚ä¹‹é—´ï¼Œæˆ‘ä»¬æ·»åŠ bl.sales.TicketServiceæ¥å£ã€‚ä¸šåŠ¡é€»è¾‘å±‚å’Œæ•°æ®å±‚ä¹‹é—´æ·»åŠ data.sales.TicketMapperæ¥å£ã€‚

blImpl.salesæ¨¡å—çš„è®¾è®¡å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚



















(3) æ¨¡å—å†…éƒ¨ç±»çš„æ¥å£è§„èŒƒ

TicketServiceImplçš„æ¥å£è§„èŒƒå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚

<table>
<tr><td colspan="3"><center>æä¾›çš„æœåŠ¡ï¼ˆä¾›æ¥å£ï¼‰</center></td></tr>
<tr><td rowspan="4">TicketServiceImpl.pickUpTicket</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO pickUpTicket(int ticketId)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>ç”µå½±ç¥¨å·²æ”¯ä»˜å¹¶æœªå–ç¥¨</td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>ä¿®æ”¹ç”µå½±ç¥¨çŠ¶æ€ä¸ºå·²å–ç¥¨</td></tr>

<tr><td rowspan="4">TicketServiceImpl.getTicketsByUser</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO getTicketsByUser(int userId)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>æ— </td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è·å–ç”¨æˆ·è´­ä¹°çš„æ‰€æœ‰ç”µå½±ç¥¨</td></tr>

<tr><td rowspan="4">TicketServiceImpl.getOrdersByUser</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO getOrdersByUser(int userId)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>æ— </td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è·å–ç”¨æˆ·çš„æ‰€æœ‰è®¢å•</td></tr>

<tr><td rowspan="4">TicketServiceImpl.addRefundTicket</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO addRefundTicket(int ticketId)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>ç”µå½±ç¥¨çŠ¶æ€ä¸ºå·²æ”¯ä»˜ä½†æœªå–ç¥¨</td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è¿”å›æŒ‡å®šç”µå½±ç¥¨å¯¹åº”çš„é€€ç¥¨ç­–ç•¥</td></tr>

<tr><td rowspan="4">TicketServiceImpl.completeRefundTicket</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO completeRefundTicket(int ticketId)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>ç”µå½±ç¥¨æ»¡è¶³é€€ç¥¨æ¡ä»¶</td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>ä¿®æ”¹ç”µå½±ç¥¨çŠ¶æ€ä¸ºå·²é€€ç¥¨</td></tr>

éœ€è¦çš„æœåŠ¡ï¼ˆéœ€æ¥å£ï¼‰

| æœåŠ¡å                                                                                              | æœåŠ¡                           |
| --------------------------------------------------------------------------------------------------- | ------------------------------ |
| TicketMapper.selectTicketById(int id)                                                               | æ ¹æ®æŒ‡å®šç”µå½±ç¥¨å·è·å–ç”µå½±ç¥¨     |
| TicketMapper.selectTicketsByUser(int userId)                                                        | è·å–æŒ‡å®šç”¨æˆ·æ‰€æœ‰çš„ç”µå½±ç¥¨       |
| TicketMapper.updateTicketState(int ticketId, int state)                                             | æ›´æ–°æŒ‡å®šç”µå½±ç¥¨çš„çŠ¶æ€           |
| ScheduleServiceForBl.getScheduleItemById(int id)                                                    |                                |
| TicketMapper.selectRefundStrategyByMovie(int movieId)                                               | è·å–æŒ‡å®šç”µå½±å¯¹åº”çš„é€€ç¥¨ç­–ç•¥     |
| TicketRefundStrategyServiceImpl.addRefundStrategy(TicketRefundStrategyForm strategyForm)            | æ–°å¢é€€ç¥¨ç­–ç•¥                   |
| TicketRefundStrategyServiceImpl.updateRefundStrategy(TicketRefundStrategyForm strategyForm)         | ä¿®æ”¹é€€ç¥¨ç­–ç•¥                   |
| TicketRefundStrategyServiceImpl.addRefundMovies(int refundStrategyId, List<Integer> movieIdList)    | å¢åŠ ä½¿ç”¨æŸé€€ç¥¨ç­–ç•¥çš„ç”µå½±       |
| TicketRefundStrategyServiceImpl.removeRefundMovies(int refundStrategyId, List<Integer> movieIdList) | åˆ é™¤ä½¿ç”¨æŸé€€ç¥¨ç­–ç•¥çš„ç”µå½±       |
| TicketRefundStrategyServiceImpl.searchAllRefundStrategy()                                           | è·å–æ‰€æœ‰å·²æœ‰çš„é€€ç¥¨ç­–ç•¥         |
| TicketRefundStrategyServiceImpl.getMoviesNotInRefundStrategy()                                      | è·å–æœªæŒ‡å®šé€€ç¥¨ç­–ç•¥çš„ç”µå½±       |
| TicketRefundStrategyServiceImpl.getMoviesByRefundStrategy(int strategyId)                           | è·å–æŒ‡å®šé€€ç¥¨ç­–ç•¥å¯¹åº”çš„ç”µå½±åˆ—è¡¨ |

TicketRefundStrategyServiceImplçš„æ¥å£è§„èŒƒå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚

<table>
<tr><td colspan="3"><center>æä¾›çš„æœåŠ¡ï¼ˆä¾›æ¥å£ï¼‰</center></td></tr>

<tr><td rowspan="4">TicketRefundStrategyServiceImpl.addRefundStrategy</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO addRefundStrategy(TicketRefundStrategyForm strategyForm)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>æ— </td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>æ–°å¢é€€ç¥¨ç­–ç•¥</td></tr>

<tr><td rowspan="4">TicketRefundStrategyServiceImpl.updateRefundStrategy</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO updateRefundStrategy(TicketRefundStrategyForm strategyForm)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>è¦ä¿®æ”¹çš„é€€ç¥¨ç­–ç•¥å·²ç»å­˜åœ¨</td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>ä¿®æ”¹é€€ç¥¨ç­–ç•¥</td></tr>

<tr><td rowspan="4">TicketRefundStrategyServiceImpl.addRefundMovies</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO addRefundMovies(int refundStrategyId, List<Integer> movieIdList)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>è¦å¢åŠ çš„ç”µå½±ä¸åœ¨é€€ç¥¨ç­–ç•¥å¯¹åº”çš„ç”µå½±åˆ—è¡¨ä¸­</td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>å¢åŠ ä½¿ç”¨æŸé€€ç¥¨ç­–ç•¥çš„ç”µå½±</td></tr>

<tr><td rowspan="4">TicketRefundStrategyServiceImpl.removeRefundMovies</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO removeRefundMovies(int refundStrategyId, List<Integer> movieIdList)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>è¦åˆ é™¤çš„ç”µå½±åœ¨é€€ç¥¨ç­–ç•¥å¯¹åº”çš„ç”µå½±åˆ—è¡¨ä¸­</td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>åˆ é™¤ä½¿ç”¨æŸé€€ç¥¨ç­–ç•¥çš„ç”µå½±</td></tr>

<tr><td rowspan="4">TicketRefundStrategyServiceImpl.searchAllRefundStrategy</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO searchAllRefundStrategy()</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>æ— </td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è·å–æ‰€æœ‰å·²æœ‰çš„é€€ç¥¨ç­–ç•¥</td></tr>

<tr><td rowspan="4">TicketRefundStrategyServiceImpl.getMoviesNotInRefundStrategy</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO getMoviesNotInRefundStrategy()</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>æ— </td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è·å–æœªæŒ‡å®šé€€ç¥¨ç­–ç•¥çš„ç”µå½±</td></tr>

<tr><td rowspan="4">TicketRefundStrategyServiceImpl.getMoviesByRefundStrategy</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO getMoviesByRefundStrategy(int strategyId)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>æ— </td></tr>
<tr><td>åç½®æ¡ä»¶</td><td>è·å–æŒ‡å®šé€€ç¥¨ç­–ç•¥å¯¹åº”çš„ç”µå½±åˆ—è¡¨</td></tr>
</table>

éœ€è¦çš„æœåŠ¡ï¼ˆéœ€æ¥å£ï¼‰

| æœåŠ¡å                                                                          | æœåŠ¡                           |
| ------------------------------------------------------------------------------- | ------------------------------ |
| TicketMapper.insertOneRefundStrategy(TicketRefundStrategy strategy)             | è®°å½•æ–°å¢çš„é€€ç¥¨ç­–ç•¥             |
| TicketMapper.updateRefundStrategy(TicketRefundStrategy strategy)                | æ›´æ–°ä¿®æ”¹çš„é€€ç¥¨ç­–ç•¥             |
| TicketMapper.insertStrategyAndMovies(int strategyId, List<Integer> movieIdList) | è®°å½•æŸé€€ç¥¨ç­–ç•¥æ–°å¢çš„ç”µå½±åˆ—è¡¨   |
| TicketMapper.deleteStrategyAndMovies(int strategyId, List<Integer> movieIdList) | åˆ é™¤æŸé€€ç¥¨ç­–ç•¥æŒ‡å®šçš„ç”µå½±åˆ—è¡¨   |
| TicketMapper.selectRefundStrategyByMovie(int movieId)                           | è·å–æŒ‡å®šç”µå½±å¯¹åº”çš„é€€ç¥¨ç­–ç•¥     |
| TicketMapper.selectRefundStrategies()                                           | è·å–å·²æœ‰çš„æ‰€æœ‰é€€ç¥¨ç­–ç•¥         |
| TicketMapper.selectMovieNotInRefundStrategy()                                   | è·å–æœªè¢«æŒ‡å®šé€€ç¥¨ç­–ç•¥çš„ç”µå½±åˆ—è¡¨ |
| TicketMapper.selectRefundStrategyById(int strategyId)                           | æ ¹æ®é€€ç¥¨ç­–ç•¥å·è·å–æŒ‡å®šé€€ç¥¨ç­–ç•¥ |
| ScheduleServiceForBl.getScheduleItemById(int scheduleId)                        | æ ¹æ®æ‹ç‰‡å·è·å–æŒ‡å®šçš„æ‹ç‰‡ä¿¡æ¯   |

(4) ä¸šåŠ¡é€»è¾‘å±‚çš„åŠ¨æ€æ¨¡å‹

ä¸‹å›¾è¡¨æ˜äº†ï¼Œå½“ç®¡ç†å‘˜æ–°å¢é€€ç¥¨ç­–ç•¥æ—¶ï¼Œsalesä¸šåŠ¡é€»è¾‘å¤„ç†çš„ç›¸å…³å¯¹è±¡ä¹‹é—´çš„åä½œã€‚



ä¸‹å›¾è¡¨æ˜äº†ï¼Œå½“ç®¡ç†å‘˜ä¿®æ”¹é€€ç¥¨ç­–ç•¥æ—¶ï¼Œsalesä¸šåŠ¡é€»è¾‘å¤„ç†çš„ç›¸å…³å¯¹è±¡ä¹‹é—´çš„åä½œã€‚

ä¸‹å›¾è¡¨æ˜äº†ï¼Œå½“ç®¡ç†å‘˜å¢åŠ æŸé€€ç¥¨ç­–ç•¥å¯¹åº”çš„ç”µå½±æ—¶ï¼Œsalesä¸šåŠ¡é€»è¾‘å¤„ç†çš„ç›¸å…³å¯¹è±¡ä¹‹é—´çš„åä½œã€‚

![](https://github.com/president-for-life/NJU-SF2/blob/master/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/%E8%BD%AF%E4%BB%B6%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%8F%8F%E8%BF%B0%E6%96%87%E6%A1%A3/sales%E6%A8%A1%E5%9D%97%E7%9A%84%E5%9B%BE/Sequence:addRefundMovies().png?raw=true)

ä¸‹å›¾è¡¨æ˜äº†ï¼Œå½“ç®¡ç†å‘˜åˆ é™¤æŸé€€ç¥¨ç­–ç•¥å¯¹åº”çš„ç”µå½±æ—¶ï¼Œsalesä¸šåŠ¡é€»è¾‘å¤„ç†çš„ç›¸å…³å¯¹è±¡ä¹‹é—´çš„åä½œã€‚
ä¸‹å›¾è¡¨æ˜äº†ï¼Œå½“è§‚ä¼—é€‰æ‹©æŸç”µå½±ç¥¨è¿›è¡Œå–ç¥¨æ—¶ï¼Œsalesä¸šåŠ¡é€»è¾‘å¤„ç†çš„ç›¸å…³å¯¹è±¡ä¹‹é—´çš„åä½œã€‚
ä¸‹å›¾è¡¨æ˜äº†ï¼Œå½“è§‚ä¼—é€‰æ‹©æŸç”µå½±ç¥¨è¿›è¡Œé€€ç¥¨æ—¶ï¼Œsalesä¸šåŠ¡é€»è¾‘å¤„ç†çš„ç›¸å…³å¯¹è±¡ä¹‹é—´çš„åä½œã€‚

(5) ä¸šåŠ¡é€»è¾‘å±‚çš„è®¾è®¡åŸç†

åˆ©ç”¨å§”æ‰˜å¼æ§åˆ¶é£æ ¼ï¼Œæ¯ä¸ªç•Œé¢éœ€è¦è®¿é—®çš„ä¸šåŠ¡é€»è¾‘ç”±å„è‡ªçš„æ§åˆ¶å™¨å§”æ‰˜ç»™ä¸åŒçš„é¢†åŸŸå¯¹è±¡ã€‚

#### 4.1.4 statisticsæ¨¡å—

(1) æ¨¡å—æ¦‚è¿°

(2) æ•´ä½“ç»“æ„

(3) æ¨¡å—å†…éƒ¨ç±»çš„æ¥å£è§„èŒƒ

æä¾›çš„æ¥å£

<table>
<tr><td colspan="3"><center>æä¾›çš„æœåŠ¡ï¼ˆä¾›æ¥å£ï¼‰</center></td></tr><tr><td rowspan="4">StatisticsServiceImpl.getConsumption</td></tr>
<tr><td>è¯­æ³•</td><td>public ResponseVO getConsumption(double amount)</td></tr>
<tr><td>å‰ç½®æ¡ä»¶</td><td>æ— </td></tr>
    <tr><td>åç½®æ¡ä»¶</td><td>è¿”å›æ¶ˆè´¹ä¸€å®šé‡‘é¢çš„ä¼šå‘˜</td></tr>
</table>

éœ€è¦çš„æ¥å£



| æœåŠ¡å                                             | æœåŠ¡                                  |
| -------------------------------------------------- | ------------------------------------- |
| statisticsMapper.selectConsumption(double amount); | æ ¹æ®é‡‘é¢æŸ¥æ‰¾å¤šä¸ªConsumptionæŒä¹…åŒ–å¯¹è±¡ |

(4) ä¸šåŠ¡é€»è¾‘å±‚çš„åŠ¨æ€æ¨¡å‹

(5) ä¸šåŠ¡é€»è¾‘å±‚çš„è®¾è®¡åŸç†

#### 4.1.5 useræ¨¡å—

(1) æ¨¡å—æ¦‚è¿°

(2) æ•´ä½“ç»“æ„

(3) æ¨¡å—å†…éƒ¨ç±»çš„æ¥å£è§„èŒƒ

éœ€è¦çš„æœåŠ¡ï¼ˆéœ€æ¥å£ï¼‰

| æœåŠ¡å                                         | æœåŠ¡                                              |
| ---------------------------------------------- | ------------------------------------------------- |
| AccountMapper.selectAdmins()                   | æŸ¥æ‰¾è¿”å›æ‰€æœ‰èº«ä»½æ˜¯Commanderï¼ˆç®¡ç†å‘˜ï¼‰çš„æŒä¹…åŒ–å¯¹è±¡ |
| AccountMapper.getAccountByName(String username)| æ ¹æ®ç”¨æˆ·åè¿”å›ç‰¹å®šå•ä¸€çš„æŒä¹…åŒ–å¯¹è±¡                |
| AccountMapper.insertOneAccount(User user)      | å¢åŠ å•ä¸€UseræŒä¹…åŒ–å¯¹è±¡                            |
| AccountMapper.updateOneAccount(User user)      | æ›´æ–°å•ä¸€UseræŒä¹…åŒ–å¯¹è±¡                            |
| AccountMapper.deleteOneAccount(int id)         | åˆ é™¤å•ä¸€UseræŒä¹…åŒ–å¯¹è±¡                            |

æä¾›çš„æœåŠ¡ï¼ˆï¼‰

(4) ä¸šåŠ¡é€»è¾‘å±‚çš„åŠ¨æ€æ¨¡å‹

(5) ä¸šåŠ¡é€»è¾‘å±‚çš„è®¾è®¡åŸç†

## 5. ä¾èµ–è§†è§’

ä¸‹å›¾æ˜¯åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚

![](https://raw.githubusercontent.com/president-for-life/NJU-SF2/master/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%8F%8F%E8%BF%B0%E6%96%87%E6%A1%A3/%E5%9B%BE%E7%89%87/%E5%8C%85%E5%9B%BE.jpg)
